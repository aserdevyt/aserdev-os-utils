#!/usr/bin/env bash
# ğŸ“¦ aserdev's "pls install my package" script ğŸ’€
# this thing will try yay â†’ pacman â†’ flatpak â†’ cry

# COLORS (bc aesthetic matters more than sanity)
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
MAGENTA="\e[35m"
CYAN="\e[36m"
RESET="\e[0m"

PKG="$1"

# if the mf didn't type a package
if [ -z "$PKG" ]; then
    echo -e "${RED}bro what package do you want me to install ğŸ’€${RESET}"
    echo "usage: install <package>"
    exit 1
fi

# PACMAN LOCK CHECK (arch usersâ€™ final boss)
if [ -f /var/lib/pacman/db.lck ]; then
    echo -e "${RED}âš  ayo chill:${RESET} pacman is literally locked rn"
    echo -e "${YELLOW}some other package manager is probably cooking${RESET}"
    read -p "$(echo -e "${MAGENTA}Force unlock? (y/n): ${RESET}")" choice

    if [[ "$choice" != "y" && "$choice" != "Y" ]]; then
        echo -e "${RED}fine leave then ğŸ™„${RESET}"
        exit 1
    else
        echo -e "${CYAN}ğŸ”“ deleting the lock like a sigma hacker...${RESET}"
        sudo rm /var/lib/pacman/db.lck
    fi
fi

echo -e "${CYAN}ğŸ“¦ Attempting to install ${MAGENTA}$PKG${RESET}"
sleep 1

# 1ï¸âƒ£ yay (AUR gigachad)
if command -v yay &>/dev/null; then
    echo -e "${YELLOW}â¡ checking yay (the aur wizard)â€¦${RESET}"
    if yay -Si "$PKG" &>/dev/null || yay -Sia "$PKG" &>/dev/null; then
        if yay -Sy --noconfirm "$PKG"; then
            echo -e "${GREEN}âœ… yay W pipeline complete${RESET}"
            exit 0
        else
            echo -e "${RED}âŒ yay fumbled the bag${RESET}"
        fi
    else
        echo -e "${RED}âŒ yay said 'idk that pkg bro'${RESET}"
    fi
fi

# 2ï¸âƒ£ pacman (the old reliable grandpa)
echo -e "${YELLOW}â¡ switching to pacmanâ€¦${RESET}"
if sudo pacman -Sy --noconfirm "$PKG"; then
    echo -e "${GREEN}ğŸ’š pacman clutched that for you${RESET}"
    exit 0
else
    echo -e "${RED}âŒ pacman tripped on the stairs${RESET}"
fi

# 3ï¸âƒ£ flatpak (the bloated fallback)
if command -v flatpak &>/dev/null; then
    echo -e "${YELLOW}â¡ checking flatpak (aka 'the discount appstore')â€¦${RESET}"
    if flatpak install -y "$PKG"; then
        echo -e "${GREEN}ğŸŸ¢ flatpak somehow worked LMAO${RESET}"
        exit 0
    else
        echo -e "${RED}âŒ flatpak cooked itselfğŸ’€${RESET}"
    fi
fi

# ğŸš¨ nothing worked
echo -e "${RED}ğŸ’€ bro I tried yay, pacman AND flatpak..."
echo -e "and this mf still doesn't exist ğŸ˜­${RESET}"
exit 1
