#!/usr/bin/env bash

# COLORS
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
MAGENTA="\e[35m"
CYAN="\e[36m"
RESET="\e[0m"

PKG="$1"

if [ -z "$PKG" ]; then
    echo "usage: install <package>"
    exit 1
fi

# üîí check pacman lock
if [ -f /var/lib/pacman/db.lck ]; then
    echo -e "${RED}‚ö† Warning:${RESET} Another package manager is running."
    echo -e "${YELLOW}Please close it before proceeding.${RESET}"
    read -p "$(echo -e "${MAGENTA}Are you sure you want to continue? (y/n): ${RESET}")" choice

    if [[ "$choice" != "y" && "$choice" != "Y" ]]; then
        echo -e "${RED}Exiting...${RESET}"
        exit 1
    else
        echo -e "${CYAN}Removing lock file...${RESET}"
        sudo rm /var/lib/pacman/db.lck
    fi
fi

echo -e "${CYAN}üì¶ Trying to install: ${MAGENTA}$PKG${RESET}"
# 1Ô∏è‚É£ yay first
if command -v yay &>/dev/null; then
    echo -e "${YELLOW}=> Trying yay‚Ä¶${RESET}"

    # check if yay can find the package before installing
    if yay -Si "$PKG" &>/dev/null || yay -Sia "$PKG" &>/dev/null; then
        if yay -Sy --noconfirm "$PKG"; then
            echo -e "${GREEN}‚úÖ Installed with yay!${RESET}"
            exit 0
        fi
    else
        echo -e "${RED}‚ùå yay: package not found${RESET}"
    fi
fi


# 2Ô∏è‚É£ pacman
echo -e "${YELLOW}=> Trying pacman‚Ä¶${RESET}"
if sudo pacman -Sy --noconfirm "$PKG"; then
    echo -e "${GREEN}‚úÖ Installed with pacman!${RESET}"
    exit 0
else
    echo -e "${RED}‚ùå pacman failed‚Ä¶${RESET}"
fi

# 3Ô∏è‚É£ flatpak
if command -v flatpak &>/dev/null; then
    echo -e "${YELLOW}=> Trying flatpak‚Ä¶${RESET}"
    if flatpak install -y "$PKG"; then
        echo -e "${GREEN}‚úÖ Installed with flatpak!${RESET}"
        exit 0
    else
        echo -e "${RED}‚ùå flatpak also cooked üíÄ${RESET}"
    fi
fi

echo -e "${RED}üíÄ bro‚Ä¶ I tried EVERYTHING. That package does NOT exist.${RESET}"
exit 1
