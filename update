#!/usr/bin/bash

# COLORS ğŸ˜­ğŸ”¥ (yes I'm using colors, fight me)
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
BLUE="\e[34m"
MAGENTA="\e[35m"
CYAN="\e[36m"
RESET="\e[0m"

# ğŸ§  Welcome to the Update Scriptâ„¢
# This thing will update your system whether it's ready or not.
# pray.

echo -e "${CYAN}â¡ Checking if pacman is being held hostage...${RESET}"

# check pacman lock
if [ -f /var/lib/pacman/db.lck ]; then
    echo -e "${RED}ğŸš¨ BRO WHAT ARE YOU DOING??${RESET}"
    echo -e "${YELLOW}Pacman is literally locked rn.${RESET}"
    echo -e "${MAGENTA}Someone (probably you) left it running.${RESET}"

    read -p "$(echo -e "${MAGENTA}Wanna risk it anyway? (y/n): ${RESET}")" choice

    if [[ "$choice" != "y" && "$choice" != "Y" ]]; then
        echo -e "${RED}ğŸ’€ coward. exiting...${RESET}"
        exit 1
    else
        echo -e "${CYAN}ğŸ’€ Removing the lock like an absolute menace...${RESET}"
        sudo rm /var/lib/pacman/db.lck
    fi
fi

echo -e "${GREEN}âœ… Starting updates... hold onto your RAM...${RESET}"
sleep 2
sudo pacman -Syu --noconfirm || {
    echo -e "${RED}Pacman said â€œnahâ€ and dipped ğŸ’€${RESET}"
    exit 1
}

echo -e "${GREEN}âœ¨ pacman is done bullying your system.${RESET}"
echo -e "${CYAN}â¡ Looking for AUR and Flatpak updates like Dora the Explorer...${RESET}"
sleep 2

echo -e "${MAGENTA}â¡ Installing *other* updates because one package manager wasn't enough.${RESET}"
sleep 1

# yay updates
if command -v yay &> /dev/null; then
    echo -e "${YELLOW}ğŸ›  Updating AUR... (brace yourself)${RESET}"
    sleep 1
    yay -Syu --noconfirm || echo -e "${RED}yay exploded LMAO ğŸ’€${RESET}"
else
    echo -e "${RED}ğŸ‘€ no yay found... skill issue.${RESET}"
fi

# flatpak updates
if command -v flatpak &> /dev/null; then
    echo -e "${BLUE}ğŸ“¦ Updating Flatpak apps (yes, even the ones you forgot exist)...${RESET}"
    sleep 1
    flatpak update -y || echo -e "${RED}flatpak update said â€œnoâ€ ğŸ’€${RESET}"
else
    echo -e "${BLUE}flatpak not foundâ€¦ good, keep it that way ğŸ’€${RESET}"
fi

echo -e "${GREEN}ğŸ‰ Everything is updated, your system is now 0.003% faster.${RESET}"
echo -e "${CYAN}âœ¨ You may now go back to wasting RAM on Electron apps.${RESET}"

exit 0
