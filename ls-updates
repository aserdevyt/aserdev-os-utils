#!/usr/bin/env bash
# ls-updates for Waybar with emojis

PACMAN=$(checkupdates 2>/dev/null | wc -l)
YAY=$(yay -Qu 2>/dev/null | wc -l)
FLATPAK=$(flatpak update --dry-run 2>/dev/null | grep -c 'Updating')

TOTAL=$((PACMAN + YAY + FLATPAK))

# decide class & emoji
if [ "$TOTAL" -eq 0 ]; then
    CLASS="ok"
    ICON="‚úÖ"
elif [ "$TOTAL" -le 10 ]; then
    CLASS="warn"
    ICON="‚ö†Ô∏è"
else
    CLASS="critical"
    ICON="üíÄ"
fi

echo "$TOTAL $ICON"
echo "{\"tooltip\":\"Pacman: $PACMAN\\nYay: $YAY\\nFlatpak: $FLATPAK\", \"class\":\"$CLASS\"}"
